# 教程 01 · 安装与环境

## 目标

- 安装 NervusDB 所需的运行时与依赖
- 构建最小可运行环境并验证 CLI / API
- 配置示例数据集供后续教程复用

## 前置要求

- Node.js ≥ 18（推荐 20/22）
- Git、pnpm（建议 8+，推荐 10）
- macOS、Linux 或 Windows（PowerShell/WSL 均可）

## 步骤一：克隆与依赖安装

```bash
git clone https://github.com/your-org/NervusDB.git
cd NervusDB
pnpm install
```

> 安装过程涉及 TypeScript、Vitest、CLI 依赖。建议全局配置 `PNPM_HOME` 后执行 `pnpm setup`。

## 步骤二：构建与全局 CLI

```bash
pnpm build                  # TypeScript -> dist/
npm i -g .                  # 生成 nervusdb 命令（可选）
# 或使用 pnpm：pnpm dlx npm -g install .

nervusdb --help            # 验证 CLI 是否可用
nervusdb --version
```

若暂不想全局安装，可使用本地脚本：

```bash
pnpm exec tsx src/cli/stats.ts <db>
```

## 步骤三：环境变量与目录

- 默认生成数据库到当前工作目录
- 建议创建专用存储目录：`mkdir -p ~/data/nervusdb`
- CLI 支持相对/绝对路径；Windows 建议使用 WSL 或 PowerShell 配合 `\`

## 步骤四：生成示例数据库

```bash
nervusdb bench demo.nervusdb 200 lsm
nervusdb stats demo.nervusdb --summary
```

输出示例：

```
triples: 820
orders.SPO.multiPagePrimaries: 1
walBytes: 512KB
hotness.top[0]: { primary: 42, score: 0.73 }
```

## 步骤五：Node.js 验证脚本

```ts
// scripts/verify.ts
import { NervusDB } from 'nervusdb';

const db = await NervusDB.open('demo.nervusdb', { enableLock: true });
const sample = await db.find({ predicate: 'FRIEND_OF' }).limit(5).all();
console.log(sample);
await db.close();
```

运行：`pnpm exec tsx scripts/verify.ts`

## 步骤六：可选工具

- **Docker**：参阅 [教程 08 · 部署与最佳实践](教程-08-部署与最佳实践.md)
- **VSCode**：安装 `ESLint`、`Prettier`、`Vitest` 插件，启用 `TypeScript: Enable Project Diagnostics`
- **MCP**：如在 AI 助手环境中使用，参考 `docs/使用示例/README.md`

## 常见问题

| 问题                | 解决方式                                                       |
| ------------------- | -------------------------------------------------------------- |
| `pnpm install` 失败 | 检查 Node 版本；执行 `pnpm env use latest`；网络问题可切换镜像 |
| `nervusdb` 未找到   | 确认 `npm i -g .` 成功并刷新 shell；或使用 `npx nervusdb`      |
| Windows 路径异常    | 使用 WSL 或 PowerShell，路径写成 `C:/data/demo.nervusdb`       |
| build 报错          | 清理 `node_modules`，执行 `pnpm install && pnpm build`         |

## 验证清单

- [ ] `nervusdb --version` 正常输出
- [ ] `nervusdb stats demo.nervusdb` 正常
- [ ] `pnpm exec tsx scripts/verify.ts` 能读取数据

## 延伸阅读

- [教程 02 · 数据模型与基础 CRUD](教程-02-数据模型与基础CRUD.md)
- [docs/使用示例/00-全局CLI-快速开始.md](../使用示例/00-全局CLI-快速开始.md)
