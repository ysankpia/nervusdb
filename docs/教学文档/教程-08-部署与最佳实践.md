# 教程 08 · 部署与最佳实践

## 打开参数（摘要）

- `indexDirectory`：索引目录（默认 `<db>.pages`）
- `pageSize`：每页三元组数（推荐 1K~2K）
- `compression`：`none | brotli:level`（冷数据更高压缩）
- `enableLock`：生产建议开启，独占写；读者不受影响
- `registerReader`：默认开启，运维工具尊重读者
- `stagingMode`：`lsm-lite`（实验）
- `enablePersistentTxDedupe`/`maxRememberTxIds`：幂等

## 生产建议

- 写锁开启；合并/GC/修复均以 dry-run 评估影响面
- 日常以增量合并为主，定期 rewrite 提升压缩比与清理墓碑
- 热点驱动：合理设置 `hot-threshold` 与 `max-primary`
- 大流量写入使用批次 +（可选）`durable: true` 保证关键事务
- 监控并关注 `walBytes/epoch/pages/orphans/hotness` 的变化趋势

## 故障注入与恢复（测试）

- 崩溃注入点：`before-page-append / before-manifest-write / before-wal-reset`
- 恢复：WAL 重放 + 尾部安全截断；必要时 repair 或 rebuildIndexes
