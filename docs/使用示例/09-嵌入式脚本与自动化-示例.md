# 示例 09 · 嵌入式脚本与自动化

## 目标

- 将 NervusDB CLI 与脚本组合到 CI/CD、运维或 AI 自动化流程中
- 展示嵌入式脚本执行模式与日志收集

## Node.js 自动化脚本

```ts
// scripts/auto-compact.ts
import { execa } from 'execa';

await execa(
  'nervusdb',
  [
    'auto-compact',
    'demo.nervusdb',
    '--mode=incremental',
    '--hot-threshold=1.2',
    '--max-primary=5',
    '--auto-gc',
  ],
  { stdio: 'inherit' },
);
```

可配合 `cron` 执行：`0 * * * * node scripts/auto-compact.js`

## CI 示例（GitHub Actions）

```yaml
jobs:
  verify:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: pnpm/action-setup@v3
      - run: pnpm install
      - run: pnpm typecheck && pnpm lint && pnpm test
      - run: pnpm build
      - run: |
          nervusdb bench ci.nervusdb 200 lsm
          nervusdb stats ci.nervusdb --summary
```

## AI 自动化

- 在 MCP 环境下可直接调用 `repomix__pack_codebase` + `nervusdb` 脚本
- 结合 `repomix` 输出，生成智能体可读的仓库上下文

## 日志收集

```bash
nervusdb stats demo.nervusdb --json | tee -a /var/log/nervusdb/stats.log
```

## 延伸阅读

- [docs/教学文档/教程-06-维护与治理.md](../教学文档/教程-06-维护与治理.md)
- [docs/使用示例/00-全局CLI-快速开始.md](00-全局CLI-快速开始.md)
