# v1.4.0 高级功能使用指南

> 适用于计划启用高级治理策略、事务幂等强化以及多语言查询扩展的用户。

## 自动压实增强

```bash
nervusdb auto-compact demo.nervusdb \
  --mode=incremental \
  --orders=SPO,POS \
  --min-merge=2 \
  --hot-threshold=1.15 \
  --max-primary=8 \
  --include-lsm-segments \
  --auto-gc
```

- 根据热度筛选主键
- 自动并入 LSM 段并执行 GC

## 事务 ID 持久化

```ts
const db = await NervusDB.open('app.nervusdb', {
  enablePersistentTxDedupe: true,
  maxRememberTxIds: 5000,
});
```

- `txids.json` 会记录历史事务 ID
- 可结合 `nervusdb txids` 管理

## GraphQL 与 Gremlin 增强

- GraphQL 支持变量、筛选、嵌套 `follow`
- Gremlin 支持 `repeat`, `path`, `valueMap`
- 参阅 `graphql_usage.md` 与 `gremlin_usage.md`

## 属性索引高级用法

```ts
const range = await db.findByEdgeProperty({
  propertyName: 'amount',
  range: { min: 1000, max: 5000 },
});

const prefix = await db.findByNodeProperty({
  propertyName: 'city',
  prefix: 'Shang',
});
```

## 热度监控

```bash
nervusdb hot demo.nervusdb --top=20 --json
```

- 输出 `score`, `pages`, `lastAccessed`

## 批处理最佳实践

- 大批量写入：按 1,000 条分批，`beginBatch` + `commitBatch`
- 失败重试：在重试时复用 `txId`
- 并行写入：拆分为不同数据库或不同 subject 范围

## 延伸阅读

- [docs/教学文档/教程-06-维护与治理.md](../教学文档/教程-06-维护与治理.md)
- [docs/教学文档/教程-04-事务-WAL-幂等.md](../教学文档/教程-04-事务-WAL-幂等.md)
