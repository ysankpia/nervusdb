# 流式查询使用教程

本教程演示如何使用 SynapseDB 的流式查询能力处理大数据集，避免一次性加载造成的内存峰值。

## 基本用法（批次）

```ts
const db = await SynapseDB.open('demo.synapsedb');
// 插入若干数据后…

for await (const batch of db.findStream({ predicate: 'KNOWS' }, { batchSize: 2000 })) {
  for (const r of batch) {
    // 逐条处理
  }
}
```

## QueryBuilder 的异步迭代器

```ts
const q = db.find({ predicate: 'KNOWS' });
for await (const r of q) {
  // 逐条处理
}

// 或按批处理
for await (const batch of q.batch(1000)) {
  // 批处理
}
```

## 与属性索引下推组合

```ts
const q = db
  .find({ predicate: 'WORKS_AT' })
  .whereProperty('age', '>=', 25) // 节点属性范围过滤
  .whereProperty('role', '=', 'dev', 'edge'); // 边属性等值过滤

for await (const r of q) {
  // 仅遍历匹配记录
}
```

## 流式聚合

```ts
const rows = await db
  .aggregate()
  .groupBy(['subject'])
  .count('count')
  .matchStream({ predicate: 'RATED' }, { batchSize: 1000 })
  .executeStreaming();
```

建议：在含分页索引的数据集上，流式查询默认在快照(epoch)下执行，保证结果一致性。
