# 全文搜索使用指南

## 目标

- 使用 NervusDB 内置全文模块构建倒排索引
- 进行关键词检索、批量索引与监控

## 引入与初始化

```ts
import { FulltextEngine } from 'nervusdb/fulltext';

const engine = await FulltextEngine.open('docs.nervusdb', {
  tokenizer: 'default',
});
```

## 批量索引

```ts
await engine.batchIndex([
  {
    id: 'doc:architecture',
    title: 'NervusDB 架构指南',
    body: '嵌入式知识库、WAL v2、链式联想、六序索引',
    tags: ['architecture'],
  },
  {
    id: 'doc:faq',
    title: '常见问题',
    body: '如何处理 WAL、auto-compact、registerReader',
  },
]);
```

- 支持增量索引，重复 ID 会覆盖
- `batchIndex` 返回处理结果与耗时

## 检索

```ts
const result = await engine.search({
  keywords: ['链式', '索引'],
  limit: 10,
  filters: { tags: 'architecture' },
});
```

- 返回命中文档 ID、分数、摘要
- `filters` 可根据索引字段过滤

## 删除文档

```ts
await engine.remove('doc:faq');
```

## 状态监控

```ts
const stats = await engine.stats();
console.log(stats.docCount, stats.indexSizeBytes);
```

## 与 NervusDB 结合

- 将文档 ID 作为三元组中的 subject/object，建立关系
- 使用 QueryBuilder 与全文结果交叉过滤

## 常见问题

| 现象       | 原因               | 解决                                |
| ---------- | ------------------ | ----------------------------------- |
| 命中率低   | 词形变化或拼写差异 | 扩展关键词、使用同义词字典          |
| 索引体积大 | 文档多且正文长     | 使用 `removeComments` 或外部压缩    |
| 搜索慢     | 未建立过滤字段     | 在索引用 JSON 字段提前存储标签/类型 |

## 延伸阅读

- [docs/教学文档/教程-05-索引选择与性能.md](../教学文档/教程-05-索引选择与性能.md)
- [docs/使用示例/图算法库使用指南.md](图算法库使用指南.md)
