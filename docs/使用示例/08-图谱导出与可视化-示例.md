# 示例 08 · 图谱导出与可视化

## 目标

- 将 NervusDB 中的图数据导出为 NDJSON/Graphviz/Gephi 可用格式
- 快速生成依赖关系图或团队关系图

## 导出 NDJSON

```bash
nervusdb dump demo.nervusdb SPO 0 --output spo-0.ndjson
```

或使用脚本：

```ts
import { NervusDB } from 'nervusdb';
import { createWriteStream } from 'node:fs';

const db = await NervusDB.open('demo.nervusdb');
const out = createWriteStream('graph.ndjson');

for await (const batch of db.streamFacts({}, 512)) {
  for (const fact of batch) out.write(`${JSON.stringify(fact)}\n`);
}

out.end();
await db.close();
```

## 转换为 Graphviz DOT

```ts
import { createWriteStream } from 'node:fs';
import readline from 'node:readline';

const input = readline.createInterface({ input: createReadStream('graph.ndjson') });
const out = createWriteStream('graph.dot');
out.write('digraph nervusdb {\n');

for await (const line of input) {
  const fact = JSON.parse(line);
  out.write(`  "${fact.subject}" -> "${fact.object}" [label="${fact.predicate}"];\n`);
}

out.write('}\n');
out.end();
```

执行 `dot -Tpng graph.dot -o graph.png`

## 导入 Gephi / Cytoscape

- 使用 `graph.ndjson` 作为 CSV/JSON 数据源，映射 `subject`/`object`/`predicate`
- 节点属性可从 `subjectProperties` 中提取

## 过滤示例

- 只导出特定谓词：`db.streamFacts({ predicate: 'FRIEND_OF' }, 512)`
- 根据属性筛选：`where()` 后再写出

## 延伸阅读

- [docs/使用示例/图算法库使用指南.md](图算法库使用指南.md)
- [实战 · 代码知识图谱](../教学文档/实战-代码知识图谱.md)
