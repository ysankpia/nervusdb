# Next Steps

## 当前版本目标：v0.2.0 (预计 2026-01-15)

**版本主题：心脏搭桥手术 - 奠定磁盘中心架构的基石**

本版本的唯一使命是完成 [ADR-001](docs/architecture/ADR-001-Architecture-Upgrade.md) 中定义的“阶段一”核心架构重构，将 NervusDB 从一个伪装的内存数据库彻底改造为一个真正的、可扩展的磁盘数据库。

### 核心目标

1.  **实现磁盘中心的数据加载与查询**
    - **价值**: 解除数据库容量与物理内存的绑定，实现亚秒级启动。
    - **状态**: 未开始 (0/3 Issues done)
    - **关键任务**: 
        - 重构 `PersistentStore.open`，使其仅加载元数据，而非全量数据。
        - 重构 `QueryEngine`，使其查询路径默认从 `PagedIndexReader` 开始，最后才合并内存增量。
        - 关联 Issue: (待创建)

2.  **实现真正的增量持久化 (`Flush`)
    - **价值**: 消除 `O(N)` 写放大，实现稳定、高效的 `O(1)` 增量写入性能。
    - **状态**: 未开始 (0/2 Issues done)
    - **关键任务**:
        - 重构 `FlushManager`，使其 `flush` 操作仅通过 `PagedIndexWriter` 追加增量数据。
        - 彻底移除对主数据文件的全量重写逻辑。
        - 关联 Issue: (待创建)

3.  **演进属性存储为磁盘结构**
    - **价值**: 将节点/边的属性也从内存限制中解放出来。
    - **状态**: 未开始 (0/2 Issues done)
    - **关键任务**:
        - 设计并实现一个基于磁盘的属性存储方案（如专用的 B-Tree 或 LSM-Tree）。
        - 将 `PropertyStore` 的读写操作全部对接到新的磁盘结构上。
        - 关联 Issue: (待创建)

### 明确不做（推迟或拒绝）

在 v0.2.0 版本中，我们将**冻结所有与“阶段一”无关的开发工作**，以确保核心重构的成功。具体包括：

- **不开发任何新的上层功能**：包括新的 MCP 工具、新的 Cypher 语法、新的图算法等。
- **不进行查询优化**：在新的磁盘架构稳定前，不投入精力到查询优化器（ADR 阶段二）的开发中。
- **不进行 API 变更**：保持现有对外 API 的稳定，所有重构都在内部完成。

### 技术债务

- 本版本的核心目标就是偿还项目当前最大的技术债务：**内存中心架构**。

### 版本完成标准

当且仅当以下所有条件都满足时，v0.2.0 版本才算完成：

- [ ] **核心目标全部完成**：上述三个核心目标的所有关键任务均已实现。
- [ ] **所有现有测试通过**：整个测试套件（`pnpm test`）必须 100% 通过，尤其是 `tests/system/` 下的崩溃注入、并发控制和快照隔离测试。
- [ ] **新的基准测试达标**：
    - [ ] 创建一个新的性能测试，证明 `flush()` 的耗时与数据库总体积无关。
    - [ ] 创建一个新的压力测试，证明数据库可以成功加载并查询一个远超物理内存大小的数据集（例如，内存 1GB，数据集 5GB）。
- [ ] **ADR-001 状态更新**：`ADR-001-Architecture-Upgrade.md` 的状态从“提议”更新为“已接受”。
